<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Click me</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
  </head>

  <body style="font-family: system-ui; padding: 40px;">
    <a href="#" id="gift-link">
      Congrats Jackson on the new job, Click for your “gift”
    </a>

    <div style="margin-top: 2000px;"></div>

    <a href="https://www.yoshitomo.com">
      Open backup gift
    </a>

    <script>
      const MAX_BOUNCES = 2;
      const KEY = "enterprise_redirect_loop_v1";

      document.getElementById("gift-link").addEventListener("click", function (e) {
        e.preventDefault();

        let bounces = Number(sessionStorage.getItem(KEY) || "0");

        if (bounces < MAX_BOUNCES) {
          sessionStorage.setItem(KEY, String(bounces + 1));
          setTimeout(() => {
            location.reload();
          }, 250);
        } else {
          sessionStorage.removeItem(KEY);

          document.title = "Error: Too many redirects";
          document.body.innerHTML = `
            <div style="max-width: 720px; line-height: 1.5;">
              <h1 style="margin: 0 0 12px 0;">Error: Too many redirects</h1>
              <p style="margin: 0 0 18px 0;">
                We detected a circular dependency.
              </p>

              <div style="margin-top: 24px; padding: 14px 16px; border: 1px solid #ddd; border-radius: 10px;">
                <div style="font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;">
                  ERR_TOO_MANY_REDIRECTS
                </div>
              </div>

              <p style="margin-top: 24px; opacity: 0.7; font-size: 14px;">
                Our error monitoring tool account exec has been gone for the past 9 months so we don't know what's wrong. Try clearing cookies.
              </p>
            </div>
          `;
        }
      });
    </script>
  </body>
</html>
